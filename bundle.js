!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var i,o="object"==typeof Reflect?Reflect:null,s=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,i){function o(){void 0!==s&&e.removeListener("error",s),n([].slice.call(arguments))}var s;"error"!==t&&(s=function(n){e.removeListener(t,o),i(n)},e.once("error",s)),e.once(t,o)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var o,s,r,a;if(c(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),r=s[t]),void 0===r)r=s[t]=n,++e._eventsCount;else if("function"==typeof r?r=s[t]=i?[n,r]:[r,n]:i?r.unshift(n):r.push(n),(o=u(e))>0&&r.length>o&&!r.warned){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=r.length,a=l,console&&console.warn&&console.warn(a)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=p.bind(i);return o.listener=n,i.wrapFn=o,o}function f(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):y(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)s(l,this,t);else{var c=l.length,u=y(l,c);for(n=0;n<c;++n)s(u[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,o,s,r;if(c(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){r=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,r||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(o=s[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){"use strict";n.r(t);const i={on(e,t){if("clock"!==e)throw new Error;const n=()=>{requestAnimationFrame(n),t(void 0,new Date/1e3)};n()}};class o{constructor({context:e,filters:t,gain:n=1,muted:i=!1}){this.context=e,this.output=e.createGain(),this.output.gain.setValueAtTime(i?0:n,e.currentTime),t?(this.filters=t.map(({type:t,amount:n,detune:i,frequency:s,gain:r,Q:a})=>{let l;switch(t){case"analyser":l=e.createAnalyser(),l.fftSize=1024,l.buffer=new Uint8Array(l.fftSize);break;case"distortion":l=e.createWaveShaper(),l.curve=o.getDistortionCurve(n),l.oversample="4x";break;default:l=e.createBiquadFilter(),l.type=t,void 0!==i&&l.detune.setValueAtTime(i,e.currentTime),void 0!==s&&l.frequency.setValueAtTime(s,e.currentTime),void 0!==r&&l.gain.setValueAtTime(r,e.currentTime),void 0!==a&&l.Q.setValueAtTime(a,e.currentTime)}return l}),this.filters.forEach((e,t)=>{t>0?this.filters[t-1].connect(e):this.input=e,t===this.filters.length-1&&e.connect(this.output)})):this.input=this.output,this._gain=n,this._muted=i}get gain(){return this._gain}set gain(e){this._gain!==e&&(this._gain=e,this.updateGain())}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this.updateGain())}updateGain(){const{context:e,gain:t,muted:n,output:i}=this,o=n?0:t;i.gain.cancelScheduledValues(0),i.gain.linearRampToValueAtTime(o,e.currentTime+.01)}static getDistortionCurve(e){const{distortionCurves:t}=o;let n=t.get(e);if(!n){const i=Math.PI/180,o=44100;n=new Float32Array(o);for(let t=0;t<o;t+=1){const s=2*t/o-1;n[t]=(3+e)*s*20*i/(Math.PI+e*Math.abs(s))}t.set(e,n)}return n}}o.analyserBands=[2,4,8,16,32,64,128,256,512],o.distortionCurves=new Map;var s=o,r=n(0);class a extends r.EventEmitter{constructor(){super(),this.cache=new Map}update(){const{cache:e}=this,t=navigator.getGamepads(),n=t.length;for(let i=0;i<n;i+=1){const n=t[i];if(n){const{id:t}=n,i=n.axes.map(e=>Math.abs(e)<a.deadZone?0:e),o=n.buttons.map(({pressed:e})=>e);let s=e.get(t);s&&(i.forEach((e,n)=>{s.axes[n]!==e&&this.emit("change",{type:"axis",gamepad:t,index:n,value:e})}),o.forEach((e,n)=>{s.buttons[n]!==e&&this.emit("change",{type:"button",gamepad:t,index:n,value:e?1:-1})})),e.set(t,{axes:i,buttons:o})}}}}a.deadZone=.1;var l=a;class c{constructor({context:e,waves:t}){this.context=e,this.output=e.createGain(),this.output.gain.setValueAtTime(1,e.currentTime),this.waves=t,this.updateWaves()}get note(){return this._note}set note(e){this._note!==e&&(this._note=e,this.updateFrequencies())}updateWaves(){const{context:e,oscillators:t,output:n,waves:i}=this;t&&t.forEach(t=>{t.output.disconnect(n),t.disconnect(t.output),t.stop(e.currentTime)});const o=i.filter(({enabled:e})=>!!e);this.oscillators=o.map(({type:t,offset:i})=>{const s=e.createGain();s.gain.setValueAtTime(1/o.length*.5,e.currentTime),s.connect(n);const r=e.createOscillator();return r.offset=i,r.type=t,r.output=s,r.connect(s),r.start(e.currentTime),r}),void 0!==this.note&&this.updateFrequencies()}updateFrequencies(){const{context:e,note:t,oscillators:n}=this;n.forEach(({frequency:n,offset:i})=>{n.cancelScheduledValues(0),n.exponentialRampToValueAtTime(c.frequencies[t+i],e.currentTime+.01)})}}c.frequencies=(()=>{const e=[];for(let t=24;t<96;t+=1)e.push(2**((t-69)/12)*440);return e})();var u=c;var d=class{constructor({dom:e,output:t}){const n=document.createElement("div");n.style.background="#000",n.style.display="flex",n.style.padding="0.25rem",e.appendChild(n);const i=document.createElement("input");i.type="range",i.min=0,i.max=1,i.step=.01,i.value=t.gain,i.style.boxSizing="border-box",i.style.width="100%",i.style.outline="none",i.addEventListener("input",({target:{value:e}})=>{t.gain=parseFloat(e)}),n.appendChild(i)}};class p{constructor({context:e,dom:t,gamepads:n,output:i}){this.context=e,this.channel=new s({context:e,filters:[{type:"highpass",frequency:512},{type:"distortion",amount:1024}],gain:1,muted:!0}),this.voice=new u({context:e,waves:[{enabled:!0,type:"sine",offset:0},{enabled:!0,type:"triangle",offset:7},{type:"sawtooth",offset:12},{type:"square",offset:14}]}),this.voice.output.connect(this.channel.input),this.channel.output.connect(i.input),this.controls={},this.mappings=new Map;const o=document.createElement("div");o.style.padding="0.5rem",t.appendChild(o),p.controls.forEach(e=>{const t=document.createElement("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.padding="0.25rem 0";const i=document.createElement("label");i.style.position="relative",i.style.flexGrow="1",i.style.padding="0 0.25rem",i.style.marginRight="0.25rem",i.style.border="1px solid #000",t.appendChild(i);const s=document.createElement("span");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.width="0%",s.style.height="100%",s.style.background="#393",i.appendChild(s);const r=document.createElement("span");r.style.position="relative",r.innerText=e,i.appendChild(r);const a={bar:s,mapping:localStorage.getItem("synthstick:mapping:"+e)||void 0,centered:localStorage.getItem(`synthstick:modifier:${e}:centered`)||!1,enabled:localStorage.getItem(`synthstick:modifier:${e}:enabled`)||!1,inverted:localStorage.getItem(`synthstick:modifier:${e}:inverted`)||!1,value:0};a.mapping&&this.mappings.set(a.mapping,e),this.controls[e]=a,p.modifiers.forEach(n=>{const i=document.createElement("button");i.style.background=a[n]?"#393":"#333",i.style.width="20px",i.style.border="1px solid #000",i.style.color="#eee",i.style.fontFamily="inherit",i.style.padding="0",i.style.outline="none",i.innerText=n.substr(0,1).toUpperCase(),i.addEventListener("click",()=>{a[n]=!a[n],i.style.background=a[n]?"#393":"#333",a[n]?localStorage.setItem(`synthstick:modifier:${e}:${n}`,!0):localStorage.removeItem(`synthstick:modifier:${e}:${n}`)}),t.appendChild(i)});const l=document.createElement("button");l.style.background="#111",l.style.border="1px solid #000",l.style.color="#eee",l.style.fontFamily="inherit",l.style.fontSize="0.8em",l.style.outline="none",l.innerText="MAP",l.addEventListener("click",()=>{l.style.background="#393",n.prependOnceListener("change",({type:t,gamepad:n,index:i})=>{l.style.background="#222",a.mapping&&this.mappings.delete(a.mapping),a.mapping=`${t}:${n}:${i}`;const o=this.mappings.get(a.mapping);o&&(localStorage.removeItem("synthstick:mapping:"+o),this.controls[o].mapping=void 0),this.mappings.set(a.mapping,e),localStorage.setItem("synthstick:mapping:"+e,a.mapping)})}),t.appendChild(l),o.appendChild(t)}),n.on("change",this.onGamepad.bind(this));const r=document.createElement("div");r.style.background="#000",r.style.display="flex",r.style.justifyContent="space-between",r.style.padding="0.5rem",t.appendChild(r),this.bpm=120;const a=document.createElement("input");a.type="number",a.min=0,a.value=120,a.style.background="#222",a.style.border="1px solid #000",a.style.color="#eee",a.style.outline="none",a.style.width="30%",a.addEventListener("change",({target:{value:e}})=>{this.bpm=parseInt(e,10)}),r.appendChild(a),this.root=p.roots[0];const l=document.createElement("select");l.style.background="#222",l.style.border="1px solid #000",l.style.color="#eee",l.style.outline="none",l.style.width="30%",l.addEventListener("change",({target:{value:e}})=>{this.root=e,this.updateNotes()}),r.appendChild(l),p.roots.forEach(e=>{const t=document.createElement("option");t.innerText=e,l.appendChild(t)}),this.scale=Object.keys(p.scales)[0];const c=document.createElement("select");c.style.background="#222",c.style.border="1px solid #000",c.style.color="#eee",c.style.outline="none",c.style.width="30%",c.addEventListener("change",({target:{value:e}})=>{this.scale=e,this.updateNotes()}),r.appendChild(c),Object.keys(p.scales).forEach(e=>{const t=document.createElement("option");t.innerText=e,c.appendChild(t)});const d=document.createElement("div");d.style.padding="0.25rem 0.5rem",t.appendChild(d),this.voice.waves.forEach((e,t)=>{const n=document.createElement("div");n.style.display="flex",n.style.justifyContent="space-between",n.style.padding="0.125rem 0";const i=document.createElement("input");i.type="checkbox",i.checked=!!e.enabled,i.addEventListener("change",({target:{checked:t}})=>{e.enabled=t,this.voice.updateWaves()}),n.appendChild(i);const o=document.createElement("select");o.style.background="#111",o.style.border="1px solid #000",o.style.color="#eee",o.style.outline="none",o.style.width="40%",o.addEventListener("change",({target:{value:t}})=>{e.type=t,this.voice.updateWaves()}),["Sine","Square","Sawtooth","Triangle"].forEach(e=>{const t=document.createElement("option");t.innerText=e,t.value=e.toLowerCase(),o.appendChild(t)}),o.value=e.type,n.appendChild(o);const s=document.createElement("input");s.type="number",s.min=0,s.value=e.offset,s.style.background="#111",s.style.border="1px solid #000",s.style.color="#eee",s.style.outline="none",s.style.width="40%",s.addEventListener("change",({target:{value:t}})=>{e.offset=parseInt(t,10),this.voice.updateWaves()}),n.appendChild(s),d.appendChild(n)}),this.updateNotes()}onGamepad({type:e,gamepad:t,index:n,value:i}){const{channel:o,context:s,controls:r,mappings:a,notes:l,voice:c}=this,u=a.get(`${e}:${t}:${n}`);if(!u)return;const d=r[u];if(d.value=d.centered&&"button"!==e?Math.abs(i):.5*(i+1),d.inverted&&(d.value=1-d.value),d.bar.style.width=100*d.value+"%",d.enabled)switch(u){case"Pitch":c.note=l[Math.floor((l.length-7)*d.value)];break;case"Gain":o.gain=d.value;break;case"HiPass":o.filters[0].frequency.cancelScheduledValues(0),o.filters[0].frequency.linearRampToValueAtTime(512+2048*d.value**2,s.currentTime+.01)}}onTick(e){const{bpm:t,channel:n,controls:i}=this,o=2**(1+Math.floor(4*(1-i.CutOff.value)));n.muted=i.CutOff.enabled&&Math.floor(e/(60/t)*32)%(2*o)>=o}updateNotes(){const{scales:e,roots:t,octave:n}=p,i=t.indexOf(this.root),o=e[this.scale],s=[];for(let e=0;e<3;e+=1){let t=12*(n+e)+i;s.push(t),o.forEach(e=>{t+=e,s.push(t)})}this.notes=s,this.voice.note=s[Math.floor((s.length-7)*this.controls.Pitch.value)]}}p.controls=["Pitch","CutOff","HiPass","Gain"],p.modifiers=["enabled","centered","inverted"],p.octave=1,p.roots=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],p.scales={Aeolian:[2,1,2,2,1,2],Locrian:[1,2,2,1,2,2],Ionian:[2,2,1,2,2,2],Dorian:[2,1,2,2,2,1],Phrygian:[1,2,2,2,1,2],Lydian:[2,2,2,1,2,2],Mixolydian:[2,2,1,2,2,1],"Melodic ascending minor":[2,1,2,2,2,2],"Phrygian raised sixth":[1,2,2,2,2,2],"Lydian raised fifth":[2,2,2,2,1,2],"Major minor":[2,2,1,2,1,2],Altered:[1,2,1,2,2,2],Eastern:[1,2,2,2,1,3]};var h=p;var f=class{constructor({analyser:e,dom:t}){this.analyser=e;const n=t.getBoundingClientRect(),i=document.createElement("canvas");i.width=n.width,i.height=n.height-279,i.style.verticalAlign="middle",t.appendChild(i),this.canvas=i,this.ctx=i.getContext("2d"),this.ctx.fillStyle="#111",this.ctx.lineWidth=2,this.ctx.strokeStyle="#393",this.animate=this.animate.bind(this),this.animate()}animate(){requestAnimationFrame(this.animate);const{analyser:e,canvas:t,ctx:n}=this;e.getByteTimeDomainData(e.buffer),n.fillRect(0,0,t.width,t.height);const i=e.buffer.length,o=1*t.width/i;n.beginPath();for(let s=0,r=0;s<i;s+=1,r+=o){const i=e.buffer[s]/128*t.height/2;0===s?n.moveTo(r,i):n.lineTo(r,i)}n.lineTo(t.width,t.height/2),n.stroke()}};const m=new AudioContext;window.addEventListener("mousedown",()=>{"running"!==m.state&&m.resume()});const y=new s({context:m,filters:[{type:"analyser"}],gain:0});y.output.connect(m.destination),document.body.style.margin="0";const v=document.getElementById("app");v.style.background="linear-gradient(#333, #151515)",v.style.color="#eee",v.style.fontFamily="sans-serif",v.style.fontSize="0.8rem",v.style.width||(v.style.width="100vw"),v.style.height||(v.style.height="100vh");const g=new l,b=(new f({analyser:y.filters[0],dom:v}),new h({context:m,dom:v,gamepads:g,output:y}));new d({dom:v,output:y});i.on("clock",(e,t)=>{g.update(),b.onTick(t)})}]);